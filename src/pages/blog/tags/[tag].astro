---
import { getBlogPosts } from "../../../content.functions";
import TagComponent from "../../../components/Tag.astro";
import BaseLayout from "../../../layouts/BaseLayout.astro";
import BlogList from "../../../components/BlogList.astro";

export async function getStaticPaths() {
  const posts = await getBlogPosts();
  const tags = posts.reduce((acc, post) => {
    if (!post.data.tags) return acc;
    return [...acc, ...post.data.tags];
  }, [] as string[]);
  return tags.map((tag) => {
    return {
      params: {
        tag,
      },
      props: {
        posts: posts
          .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf())
          .filter((post) => post.data.tags?.includes(tag)),
      },
    };
  });
}

const { tag } = Astro.params;
const { posts } = Astro.props;
---

<BaseLayout title="Blog Posts" description="Posts">
  <h1 class="text-primary text-xl">
    Posts tagged with: <TagComponent tag={tag} />
  </h1>
  <BlogList posts={posts} />
</BaseLayout>
